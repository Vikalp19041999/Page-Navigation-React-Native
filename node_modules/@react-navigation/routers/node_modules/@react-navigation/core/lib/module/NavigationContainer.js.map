{"version":3,"sources":["NavigationContainer.tsx"],"names":["React","CommonActions","EnsureSingleNavigator","NavigationBuilderContext","useFocusedListeners","useDevTools","useStateGetters","isSerializable","MISSING_CONTEXT_ERROR","NavigationStateContext","createContext","isDefault","getState","Error","setState","performTransaction","hasWarnedForSerialization","getPartialState","state","undefined","key","routeNames","partialState","stale","routes","map","route","Container","forwardRef","NavigationContainer","ref","initialState","onStateChange","independent","children","parent","useContext","useState","setNavigationState","navigationStateRef","useRef","transactionStateRef","isTransactionActiveRef","isFirstMountRef","skipTrackingRef","useCallback","callback","current","navigationState","reset","name","trackState","trackAction","listeners","addFocusedListener","addListener","getStateForRoute","addStateGetter","dispatch","action","navigation","canGoBack","result","handled","resetRoot","getRootState","useImperativeHandle","Object","keys","reduce","acc","builderContext","useMemo","context","useEffect","process","env","NODE_ENV","console","warn"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as CommonActions from './CommonActions';\nimport EnsureSingleNavigator from './EnsureSingleNavigator';\nimport NavigationBuilderContext from './NavigationBuilderContext';\nimport useFocusedListeners from './useFocusedListeners';\nimport useDevTools from './useDevTools';\nimport useStateGetters from './useStateGetters';\nimport isSerializable from './isSerializable';\n\nimport {\n  Route,\n  NavigationState,\n  InitialState,\n  PartialState,\n  NavigationAction,\n  NavigationContainerRef,\n  NavigationContainerProps,\n} from './types';\n\ntype State = NavigationState | PartialState<NavigationState> | undefined;\n\nconst MISSING_CONTEXT_ERROR =\n  \"We couldn't find a navigation context. Have you wrapped your app with 'NavigationContainer'?\";\n\nexport const NavigationStateContext = React.createContext<{\n  isDefault?: true;\n  state?: NavigationState | PartialState<NavigationState>;\n  getState: () => NavigationState | PartialState<NavigationState> | undefined;\n  setState: (\n    state: NavigationState | PartialState<NavigationState> | undefined\n  ) => void;\n  key?: string;\n  performTransaction: (action: () => void) => void;\n}>({\n  isDefault: true,\n\n  get getState(): any {\n    throw new Error(MISSING_CONTEXT_ERROR);\n  },\n  get setState(): any {\n    throw new Error(MISSING_CONTEXT_ERROR);\n  },\n  get performTransaction(): any {\n    throw new Error(MISSING_CONTEXT_ERROR);\n  },\n});\n\nlet hasWarnedForSerialization = false;\n\n/**\n * Remove `key` and `routeNames` from the state objects recursively to get partial state.\n *\n * @param state Initial state object.\n */\nconst getPartialState = (\n  state: InitialState | undefined\n): PartialState<NavigationState> | undefined => {\n  if (state === undefined) {\n    return;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { key, routeNames, ...partialState } = state;\n\n  // @ts-ignore\n  return {\n    ...partialState,\n    stale: true,\n    routes: state.routes.map(route => {\n      if (route.state === undefined) {\n        return route as Route<string> & {\n          state?: PartialState<NavigationState>;\n        };\n      }\n\n      return { ...route, state: getPartialState(route.state) };\n    }),\n  };\n};\n\n/**\n * Container component which holds the navigation state.\n * This should be rendered at the root wrapping the whole app.\n *\n * @param props.initialState Initial state object for the navigation tree.\n * @param props.onStateChange Callback which is called with the latest navigation state when it changes.\n * @param props.children Child elements to render the content.\n * @param props.ref Ref object which refers to the navigation object containing helper methods.\n */\nconst Container = React.forwardRef(function NavigationContainer(\n  {\n    initialState,\n    onStateChange,\n    independent,\n    children,\n  }: NavigationContainerProps,\n  ref: React.Ref<NavigationContainerRef>\n) {\n  const parent = React.useContext(NavigationStateContext);\n\n  if (!parent.isDefault && !independent) {\n    throw new Error(\n      \"Looks like you have nested a 'NavigationContainer' inside another. Normally you need only one container at the root of the app, so this was probably an error. If this was intentional, pass 'independent={true}' explicitely.\"\n    );\n  }\n\n  const [state, setNavigationState] = React.useState<State>(() =>\n    getPartialState(initialState == null ? undefined : initialState)\n  );\n\n  const navigationStateRef = React.useRef<State>();\n  const transactionStateRef = React.useRef<State | null>(null);\n  const isTransactionActiveRef = React.useRef<boolean>(false);\n  const isFirstMountRef = React.useRef<boolean>(true);\n  const skipTrackingRef = React.useRef<boolean>(false);\n\n  const performTransaction = React.useCallback((callback: () => void) => {\n    if (isTransactionActiveRef.current) {\n      throw new Error(\n        \"Only one transaction can be active at a time. Did you accidentally nest 'performTransaction'?\"\n      );\n    }\n\n    setNavigationState((navigationState: State) => {\n      isTransactionActiveRef.current = true;\n      transactionStateRef.current = navigationState;\n\n      try {\n        callback();\n      } finally {\n        isTransactionActiveRef.current = false;\n      }\n\n      return transactionStateRef.current;\n    });\n  }, []);\n\n  const getState = React.useCallback(\n    () =>\n      transactionStateRef.current !== null\n        ? transactionStateRef.current\n        : navigationStateRef.current,\n    []\n  );\n\n  const setState = React.useCallback((navigationState: State) => {\n    if (transactionStateRef.current === null) {\n      throw new Error(\n        \"Any 'setState' calls need to be done inside 'performTransaction'\"\n      );\n    }\n\n    transactionStateRef.current = navigationState;\n  }, []);\n\n  const reset = React.useCallback(\n    (state: NavigationState) => {\n      performTransaction(() => {\n        skipTrackingRef.current = true;\n        setState(state);\n      });\n    },\n    [performTransaction, setState]\n  );\n\n  const { trackState, trackAction } = useDevTools({\n    name: '@react-navigation',\n    reset,\n    state,\n  });\n\n  const { listeners, addListener: addFocusedListener } = useFocusedListeners();\n\n  const { getStateForRoute, addStateGetter } = useStateGetters();\n\n  const dispatch = (\n    action: NavigationAction | ((state: NavigationState) => NavigationAction)\n  ) => {\n    listeners[0](navigation => navigation.dispatch(action));\n  };\n\n  const canGoBack = () => {\n    const { result, handled } = listeners[0](navigation =>\n      navigation.canGoBack()\n    );\n\n    if (handled) {\n      return result;\n    } else {\n      return false;\n    }\n  };\n\n  const resetRoot = React.useCallback(\n    (state?: PartialState<NavigationState> | NavigationState) => {\n      performTransaction(() => {\n        trackAction('@@RESET_ROOT');\n        setState(state);\n      });\n    },\n    [performTransaction, setState, trackAction]\n  );\n\n  const getRootState = React.useCallback(() => {\n    return getStateForRoute('root');\n  }, [getStateForRoute]);\n\n  React.useImperativeHandle(ref, () => ({\n    ...(Object.keys(CommonActions) as (keyof typeof CommonActions)[]).reduce<\n      any\n    >((acc, name) => {\n      acc[name] = (...args: any[]) =>\n        dispatch(\n          CommonActions[name](\n            // @ts-ignore\n            ...args\n          )\n        );\n      return acc;\n    }, {}),\n    resetRoot,\n    dispatch,\n    canGoBack,\n    getRootState,\n  }));\n\n  const builderContext = React.useMemo(\n    () => ({\n      addFocusedListener,\n      addStateGetter,\n      trackAction,\n    }),\n    [addFocusedListener, trackAction, addStateGetter]\n  );\n\n  const context = React.useMemo(\n    () => ({\n      state,\n      performTransaction,\n      getState,\n      setState,\n    }),\n    [getState, performTransaction, setState, state]\n  );\n\n  React.useEffect(() => {\n    if (process.env.NODE_ENV !== 'production') {\n      if (\n        state !== undefined &&\n        !isSerializable(state) &&\n        !hasWarnedForSerialization\n      ) {\n        hasWarnedForSerialization = true;\n\n        console.warn(\n          \"We found non-serializable values in the navigation state, which can break usage such as persisting and restoring state. This might happen if you passed non-serializable values such as function, class instances etc. in params. If you need to use functions in your options, you can use 'navigation.setOptions' instead.\"\n        );\n      }\n    }\n\n    if (skipTrackingRef.current) {\n      skipTrackingRef.current = false;\n    } else {\n      trackState(getRootState);\n    }\n\n    navigationStateRef.current = state;\n    transactionStateRef.current = null;\n\n    if (!isFirstMountRef.current && onStateChange) {\n      onStateChange(getRootState());\n    }\n\n    isFirstMountRef.current = false;\n  }, [state, onStateChange, trackState, getRootState]);\n\n  return (\n    <NavigationBuilderContext.Provider value={builderContext}>\n      <NavigationStateContext.Provider value={context}>\n        <EnsureSingleNavigator>{children}</EnsureSingleNavigator>\n      </NavigationStateContext.Provider>\n    </NavigationBuilderContext.Provider>\n  );\n});\n\nexport default Container;\n"]}